---
title: "HDChangePoint"
author: "Unkyung Lee"
date: "4/23/2019"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{my-vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(collapse = TRUE, comment = "#>")
```

```{r setup}
library(HDChangePoint)
```


## Overview
The R package `HDChangePoint` implements two estimation methods under the proposed nonlinear location-shift marker model that captures disease symptom progression and evalutes the relationship between disease progression and potential biomarkers.

Two methods are the parametric nonlinear mixed effects model (NLME) and the multi-stage nonparametric estimations. They estimate individual longitudinal trajectories in an "S"-shape and their respective inflection points. These estimation methods are described in the following manuscript: 

**U.Lee, R.J.Carroll, K.Marder, Y.wang and T.P.Garcia. (2018+) "Estimating Disease Onset from Change Points of Markers Measured with Error"** 

To reproduce the results in our paper, `HDChangePoint` provides the following datasets:

1.**PSEUDO_PREDICT_HD_DATA.csv**: a simulated dataset for data analaysis, see 
**data-raw\/PSEUDO_PREDICT_HD.R** 

2.**nonpara_logist_visit1.RData**: simulation results based on 100 simulation runs for the multi-stage nonparametric approach, where true data are generated by the logistic model and the total number of clinical visits $m$ are 5, 6, or 7 for each subject. 

3.**nonpara_logist_visit2.RData**: simulation results based on 100 simulation runs for the multi-stage nonparametric approach, where true data are generated by the logistic model and the total number of clinical visits $m$ are 5, 6, or 7 for each subject.

4.**nonpara_logist_visit3.RData**: simulation results based on 100 simulation runs for the multi-stage nonparametric approach, where true data are generated by the logistic model and the total number of clinical visits $m$ are 5, 6, or 7 for each subject.


## Installation 

To install `HDChangePoint` from GitHub,
```{r, eval=FALSE}
devtools::install_github("unkyunglee/HDChangePoint")
```

## Usage
```{r usage, eval=F, results='hide', message=FALSE}
library(HDChangePoint)

# Specify parameters for data generation
n=80;
model="logist";
p=2;
bb0=0.5;
bb=0.1;
x.sd=0.3;
v1=5;
v2=7;
dist="normal";
eps.sd=0.05;
u.sd=0.05;

set.seed(22)
# Generate a dataset under the logistic model
outdat<-mydata(n=n, model=model, p=p, bb0=bb0, bb=bb, x.sd=x.sd, 
               v1=v1, v2=v2, dist=dist, eps.sd=eps.sd, u.sd=u.sd)


# Specify parameters for the multi-stage nonparametric procedure
num.interp=45;
newl=45;
k1=20;
k2=20;
mean.diff=1;
tolerance=0.009
itermax=20;
iter=0;

# Multi-stage nonparametric estimation
results<-sim.nonpara(n=n, model="logist", num.interp=num.interp, newl=newl, dist="normal", 
                     k1=k1, k2=k2, eps.sd=eps.sd, 
                     mean.diff=mean.diff, tolerance=tolerance, itermax=itermax, iter=iter, 
                     dat=outdat)

```

## Example 1.

We give an example to reproduce the part of the simulation results in Table 1 in our manuscript. We consider the `nonpara_logist_visit1` data available from R package `HDChangePoint`. 

```{r ex1}
library(HDChangePoint)
# load simulated data
data(nonpara_logist_visit1)
```

We specify parameters and obtain the results as the part of the Table 1 and plots (c) and (d) in Figure 2. Plots will be automatrically saved as .eps file in your working directory. 

```{r simuout, cache=TRUE}
# Specify parameters in the summary function
nsim=100;
n=80;
num.interp=45;
newl=45;
bb.true=0.1;
b0.true=0.5;
true.sigma.u=0.05;
true.sigma.eps=0.05;

# Produce the results 
simus.out1<-HDChangePoint::simus.results(nsim=nsim, n=n, res=results, model="logist", 
                          num.interp=num.interp, newl=newl, 
                          bb.true=bb.true, b0.true=b0.true, 
                          true.sigma.u=true.sigma.u, true.sigma.eps=true.sigma.eps,
                          file="logist_visit1")
simus.out1$res.table

```


## Example 2.

We give an example to reproduce the part of the simulation results in Table 1 in our manuscript. We consider the `nonpara_logist_visit2` data available from R package `HDChangePoint`. 

```{r ex2}
library(HDChangePoint)
# load simulated data
data(nonpara_logist_visit2)
```

We specify parameters and obtain the results as the part of the Table 1. 

```{r simuout, cache=TRUE}
# Specify parameters in the summary function
nsim=100;
n=80;
num.interp=45;
newl=45;
bb.true=0.1;
b0.true=0.5;
true.sigma.u=0.05;
true.sigma.eps=0.05;

# Produce the results 
simus.out2<-HDChangePoint::simus.results(nsim=nsim, n=n, res=results, model="logist", 
                          num.interp=num.interp, newl=newl, 
                          bb.true=bb.true, b0.true=b0.true, 
                          true.sigma.u=true.sigma.u, true.sigma.eps=true.sigma.eps,
                          file="logist_visit2")
simus.out2$res.table

```


## Example 3.

We give an example to reproduce the part of the simulation results in Table 1 in our manuscript. We consider the  `nonpara_logist_visit3.RData` data available from R package `HDChangePoint`. 

```{r ex3}
library(HDChangePoint)
# load simulated data
data(nonpara_logist_visit3)
```

We specify parameters and obtain the results as the part of the Table 1. 

```{r simuout, cache=TRUE}
# Specify parameters in the summary function
nsim=100;
n=80;
num.interp=45;
newl=45;
bb.true=0.1;
b0.true=0.5;
true.sigma.u=0.05;
true.sigma.eps=0.05;

# Produce the results 
simus.out3<-HDChangePoint::simus.results(nsim=nsim, n=n, res=results, model="logist", 
                          num.interp=num.interp, newl=newl, 
                          bb.true=bb.true, b0.true=b0.true, 
                          true.sigma.u=true.sigma.u, true.sigma.eps=true.sigma.eps,
                          file="logist_visit3")
simus.out3$res.table

```


## Example 4. 

We give an example to show reproducibility for data analysis study in our manuscript. We consider the `PSEUDO_PREDICT_HD` data available from R package `HDChangePoint`. This data is a simulated dataset using the data generation function `pseudo.HD()`, see `data-raw\PSEUDO_PREDICT_HD.R`. 

```{r pseudo_data}
library(HDChangePoint)
data(PSEUDO_PREDICT_HD)

```




The data consist of 80 subjects' information with 8 variables. Each subject made different number of visits $m=5,6$ or $7$ at clinics. In the `PSEUDO_PREDICT_HD` data, we consider two subject specific covariates: CAG repeats and gender, which may be associated with inflection points.

```{r data_info, cache=TRUE}
head(PSEUDO_PREDICT_HD)
?PSEUDO_PREDICT_HD # this gives you more information on the dataset
```

We fit our methods to the `PSEUDO_PREDICT_HD` data. First, we specify the parameters for the function `hd.study()`  and run it to produce similar results to Table 4 and Figure 1 in our manuscript. Figure will be automatically saved in your directory. 

```{r pseudo_analysis, message=FALSE,  cache=TRUE}

   library(HDChangePoint)

   # Specify the parameters
   simu.dat<-PSEUDO_PREDICT_HD
   n=80;
   m=45;
   num.interp=45;
   newl=45;
   mean.diff=1;
   tolerance=0.01;
   itermax=20;
   iter=0;

   # produce two tables to reproduce Table 4 in the paper and Figure 1.
   simu.analysis.results<-HDChangePoint::hd.study(simu.data=simu.data, m=m, num.interp=num.interp, 
                                                  n=n, newl=newl, mean.diff=mean.diff, 
                                                  tolerance=tolerance, itermax=itermax, iter=iter)

   # produce results
   simu.analysis.results$nonpara_summary_table4
   simu.analysis.results$para_summary_table4
```
